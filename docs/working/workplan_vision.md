# 工作计划 vision

本文档包含工作流 vision 的动态任务规划和分解。

## 工作流信息
- 工作ID: vision
- 创建时间: 2025-07-20
- 状态: PLANNING
- 描述: 开发窗口内容结构化解析工具
- 总体进度: 5%
- 特别注意：不要做历史纪录，只更新最后结果！

## 任务树

- T1 [10%] 需求分析与技术调研
  - T1.1 [30%] 明确功能需求
  - T1.2 [20%] 技术可行性分析
  - T1.3 [10%] 接口设计
  - T1.4 [0%] 性能基准测试
- T2 [0%] 核心功能开发
  - T2.1 [0%] 窗口截图模块
    - T2.1.1 [0%] 基础截图功能
    - T2.1.2 [0%] 区域截图功能
    - T2.1.3 [0%] 多显示器支持
  - T2.2 [0%] 图像预处理模块
    - T2.2.1 [0%] 图像增强
    - T2.2.2 [0%] 区域分割
    - T2.2.3 [0%] 降噪处理
  - T2.3 [0%] 视觉识别模块
    - T2.3.1 [0%] UI元素检测
    - T2.3.2 [0%] 文本识别(OCR)
    - T2.3.3 [0%] 图标识别
  - T2.4 [0%] 结构化转换模块
    - T2.4.1 [0%] 元素关系构建
    - T2.4.2 [0%] 层次结构生成
    - T2.4.3 [0%] JSON序列化
- T3 [0%] 工具函数封装 [PARALLEL]
  - T3.1 [0%] 同步接口实现
  - T3.2 [0%] 异步接口实现
  - T3.3 [0%] 批处理接口
  - T3.4 [0%] 流式处理接口
- T4 [0%] 性能优化
  - T4.1 [0%] 模型优化
    - T4.1.1 [0%] 模型量化
    - T4.1.2 [0%] 模型剪枝
    - T4.1.3 [0%] 推理加速
  - T4.2 [0%] 缓存机制
    - T4.2.1 [0%] 结果缓存
    - T4.2.2 [0%] 模型缓存
    - T4.2.3 [0%] 预处理缓存
  - T4.3 [0%] 并行处理
    - T4.3.1 [0%] 多线程优化
    - T4.3.2 [0%] GPU加速
    - T4.3.3 [0%] 批量推理
- T5 [0%] 测试与文档
  - T5.1 [0%] 单元测试
  - T5.2 [0%] 集成测试
  - T5.3 [0%] 性能测试
  - T5.4 [0%] API文档
  - T5.5 [0%] 使用示例

## 任务详情

### T1: 需求分析与技术调研
- 优先级: 高
- 依赖: 无
- 描述: 明确工具的功能需求，评估技术方案，设计接口。

### T1.1: 明确功能需求
- 优先级: 高
- 依赖: 无
- 描述: 定义窗口内容结构化解析的具体需求。
- 已明确需求:
  - 输入：窗口句柄(hwnd)或截图
  - 输出：结构化的JSON数据
  - 性能：单次调用<1秒
  - 准确率：UI元素识别>95%

### T1.2: 技术可行性分析
- 优先级: 高
- 依赖: T1.1
- 描述: 评估不同技术方案的可行性。
- 技术选项:
  - 传统CV：OpenCV + 模板匹配
  - 深度学习：YOLO/MobileNet + OCR
  - 混合方案：CV + DL结合

### T1.3: 接口设计
- 优先级: 高
- 依赖: T1.1
- 描述: 设计工具的API接口。
- 核心接口:
  ```python
  # 基础接口
  def parse_window_content(hwnd: int) -> dict
  def parse_screenshot(image: np.ndarray) -> dict
  
  # 高级接口
  def parse_window_region(hwnd: int, region: tuple) -> dict
  def parse_with_options(hwnd: int, options: dict) -> dict
  ```

### T2: 核心功能开发
- 优先级: 高
- 依赖: T1
- 描述: 开发窗口内容解析的核心功能模块。

### T2.1: 窗口截图模块
- 优先级: 高
- 依赖: T1.3
- 描述: 实现高效的窗口截图功能。
- 技术要点:
  - Win32 API截图
  - DirectX截图（备选）
  - 内存优化

### T2.2: 图像预处理模块
- 优先级: 中
- 依赖: T2.1
- 描述: 对截图进行预处理，提高识别准确率。

### T2.3: 视觉识别模块
- 优先级: 高
- 依赖: T2.2
- 描述: 使用视觉模型识别UI元素。
- 关键组件:
  - UI元素检测器
  - OCR引擎
  - 图标分类器

### T2.4: 结构化转换模块
- 优先级: 高
- 依赖: T2.3
- 描述: 将识别结果转换为结构化数据。
- 输出格式:
  ```json
  {
    "window": {
      "title": "窗口标题",
      "size": [width, height],
      "elements": [
        {
          "type": "button",
          "text": "确定",
          "bounds": [x, y, w, h],
          "properties": {}
        }
      ]
    }
  }
  ```

### T3: 工具函数封装
- 优先级: 中
- 依赖: T2
- 描述: 封装易用的工具函数接口。

### T4: 性能优化
- 优先级: 中
- 依赖: T2, T3
- 描述: 优化工具的性能，达到生产级要求。

### T4.1: 模型优化
- 优先级: 高
- 依赖: T2.3
- 描述: 优化视觉模型的推理性能。

### T4.2: 缓存机制
- 优先级: 中
- 依赖: T3
- 描述: 实现智能缓存，减少重复计算。

### T5: 测试与文档
- 优先级: 中
- 依赖: T3
- 描述: 完善测试用例和使用文档。

## 并行任务管理

### 并行任务组定义
使用 `[PARALLEL]` 标记可以并行执行的任务组：

1. **T3 工具函数封装 [PARALLEL]**
   - 并行原因: 不同接口可以独立开发
   - 同步点: 核心功能完成后
   - 预期时间节省: 40%

### 同步检查点
- T2完成后，T3的各个接口可以并行开发
- T3完成后，T4的优化工作可以开始
- T4.1、T4.2、T4.3可以并行进行

## 动态规划笔记

- 优先实现最小可行产品(MVP)，先支持基础的窗口解析
- 考虑使用现有的OCR服务（如Windows OCR API）加速开发
- 模型选择要平衡精度和性能，建议先用轻量级模型
- **关键决策**: 是否需要支持实时解析（>10fps）？
- **风险点**: 不同应用的UI框架差异可能影响识别准确率
- **优化方向**: 可以针对特定应用（如Cursor、VSCode）做专门优化

## 近期任务更新 (work_id=vision)

### T2.5: Cursor IDE交互精度改进 [NEW]
- 优先级: 高
- 依赖: T2.3
- 状态: 规划中
- 描述: 改进Cursor IDE文字发送到对话框的精度问题
- 具体任务:
  - T2.5.1 增强UI检测精度 - 结合Cursor IDE特有UI特征进行精确定位
  - T2.5.2 添加输入验证机制 - 检测文字是否真正被输入到对话框
  - T2.5.3 实现自适应定位 - 基于实际响应动态调整策略
  - T2.5.4 测试改进后的文字发送精度
- 当前问题分析:
  - 输入框检测逻辑过于简单（基于尺寸200x20的判断）
  - 缺乏Cursor IDE特有UI布局的适配
  - 没有输入成功的验证反馈机制
- 解决方案:
  - 使用多重检测策略：视觉模型 + 特征匹配 + 区域分析
  - 增加剪贴板输入方式作为备选
  - 实现输入结果验证和重试机制