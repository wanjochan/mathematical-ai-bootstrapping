# CyberCorp 操作控制端架构设计

## 1. 概述

CyberCorp 操作控制端是虚拟公司三层架构中的客户端组件，负责窗口和进程管理、系统监控以及与后端服务器通信。该组件作为系统的操作层，提供了对虚拟公司运行环境的直接控制能力。

## 2. 架构设计

### 2.1 整体架构

```
+-------------------+        +-------------------+
|                   |        |                   |
|  cybercorp_web    |<------>|  cybercorp_server |
|  (前端界面)        |   API   |  (后端服务)       |
|                   |        |                   |
+-------------------+        +---------^---------+
                                       |
                                       | API/WebSocket
                                       |
                              +--------v----------+
                              |                   |
                              |  cybercorp_oper   |
                              |  (操作控制端)      |
                              |                   |
                              +-------------------+
```

### 2.2 分层架构

```
+-------------------------------------------------------+
|                     UI 层                             |
|  (本地界面, 状态显示, 控制面板)                          |
+-------------------------------------------------------+
|                     控制层                            |
|  (窗口管理, 进程管理, 系统监控)                          |
+-------------------------------------------------------+
|                     通信层                            |
|  (API客户端, WebSocket客户端, 事件处理)                  |
+-------------------------------------------------------+
|                     核心层                            |
|  (配置管理, 安全相关, 日志系统, 工具函数)                 |
+-------------------------------------------------------+
```

## 3. 组件设计

### 3.1 UI 层

#### 3.1.1 本地界面

- **主控制面板**：显示系统状态和控制选项
- **窗口管理界面**：管理虚拟窗口
- **进程管理界面**：管理虚拟进程
- **系统监控界面**：显示系统监控信息

#### 3.1.2 状态显示

- **系统状态**：显示系统的运行状态
- **窗口状态**：显示窗口的状态
- **进程状态**：显示进程的状态
- **连接状态**：显示与服务器的连接状态

#### 3.1.3 控制面板

- **窗口控制**：控制窗口的创建、关闭和调整
- **进程控制**：控制进程的启动、停止和重启
- **系统控制**：控制系统的启动、停止和重启

### 3.2 控制层

#### 3.2.1 窗口管理

- **窗口创建**：创建新窗口
- **窗口关闭**：关闭窗口
- **窗口调整**：调整窗口大小和位置
- **窗口焦点**：管理窗口焦点

#### 3.2.2 进程管理

- **进程启动**：启动新进程
- **进程停止**：停止进程
- **进程重启**：重启进程
- **进程监控**：监控进程状态

#### 3.2.3 系统监控

- **资源监控**：监控系统资源使用情况
- **性能监控**：监控系统性能
- **事件监控**：监控系统事件

### 3.3 通信层

#### 3.3.1 API客户端

- **请求发送**：向服务器发送API请求
- **响应处理**：处理服务器的API响应
- **错误处理**：处理API请求错误

#### 3.3.2 WebSocket客户端

- **连接管理**：管理WebSocket连接
- **消息发送**：向服务器发送WebSocket消息
- **消息接收**：接收服务器的WebSocket消息
- **心跳管理**：管理WebSocket心跳

#### 3.3.3 事件处理

- **事件订阅**：订阅服务器事件
- **事件接收**：接收服务器事件
- **事件处理**：处理服务器事件

### 3.4 核心层

#### 3.4.1 配置管理

- **配置加载**：加载配置文件
- **配置验证**：验证配置的有效性
- **配置热重载**：支持配置的热重载

#### 3.4.2 安全相关

- **认证**：用户认证
- **授权**：用户授权
- **加密**：数据加密
- **令牌管理**：JWT令牌管理

#### 3.4.3 日志系统

- **日志记录**：记录系统日志
- **日志级别**：支持不同级别的日志
- **日志格式**：支持不同格式的日志
- **日志输出**：支持不同输出目标的日志

#### 3.4.4 工具函数

- **数据验证**：验证数据的有效性
- **辅助函数**：提供各种辅助函数

## 4. 通信协议

### 4.1 API通信

- **请求格式**：HTTP请求
- **响应格式**：JSON格式
- **认证方式**：JWT令牌认证
- **错误处理**：HTTP状态码和错误消息

### 4.2 WebSocket通信

- **连接建立**：WebSocket握手
- **消息格式**：JSON格式
- **认证方式**：JWT令牌认证
- **心跳机制**：定期发送心跳消息

## 5. 窗口和进程管理

### 5.1 窗口管理

- **窗口模型**：窗口的数据模型
  ```python
  class Window:
      id: str
      title: str
      position: Tuple[int, int]
      size: Tuple[int, int]
      visible: bool
      focused: bool
      process_id: str
      created_at: datetime
      updated_at: datetime
  ```

- **窗口操作**：窗口的操作接口
  - `create_window(title, position, size) -> Window`：创建窗口
  - `close_window(window_id) -> bool`：关闭窗口
  - `resize_window(window_id, size) -> bool`：调整窗口大小
  - `move_window(window_id, position) -> bool`：移动窗口
  - `show_window(window_id) -> bool`：显示窗口
  - `hide_window(window_id) -> bool`：隐藏窗口
  - `focus_window(window_id) -> bool`：聚焦窗口

### 5.2 进程管理

- **进程模型**：进程的数据模型
  ```python
  class Process:
      id: str
      name: str
      status: str
      cpu_usage: float
      memory_usage: float
      window_id: Optional[str]
      created_at: datetime
      updated_at: datetime
      started_at: Optional[datetime]
      stopped_at: Optional[datetime]
  ```

- **进程操作**：进程的操作接口
  - `start_process(name) -> Process`：启动进程
  - `stop_process(process_id) -> bool`：停止进程
  - `restart_process(process_id) -> bool`：重启进程
  - `get_process_status(process_id) -> str`：获取进程状态
  - `get_process_metrics(process_id) -> Dict`：获取进程指标

## 6. 系统监控

### 6.1 资源监控

- **CPU监控**：监控CPU使用情况
- **内存监控**：监控内存使用情况
- **磁盘监控**：监控磁盘使用情况
- **网络监控**：监控网络使用情况

### 6.2 性能监控

- **响应时间**：监控系统响应时间
- **吞吐量**：监控系统吞吐量
- **错误率**：监控系统错误率

### 6.3 事件监控

- **系统事件**：监控系统事件
- **用户事件**：监控用户事件
- **错误事件**：监控错误事件

## 7. 安全设计

### 7.1 认证与授权

- **用户认证**：使用JWT令牌认证
- **用户授权**：基于角色的访问控制
- **令牌管理**：令牌的生成、验证和刷新

### 7.2 数据安全

- **数据加密**：敏感数据的加密
- **数据验证**：输入数据的验证
- **数据备份**：定期备份数据

## 8. 部署设计

### 8.1 安装部署

- **安装包**：提供安装包
- **自动更新**：支持自动更新

### 8.2 环境配置

- **开发环境**：用于开发和测试
- **生产环境**：用于生产部署

## 9. 与其他组件的关系

### 9.1 与cybercorp_server的关系

- **发送请求**：向服务器发送请求
- **接收响应**：接收服务器的响应
- **接收事件**：接收服务器的事件

### 9.2 与cybercorp_web的关系

- **间接关系**：通过服务器间接交互

## 10. 未来扩展

### 10.1 功能扩展

- **支持更多窗口类型**：支持更多类型的窗口
- **支持更多进程类型**：支持更多类型的进程
- **支持更多监控功能**：支持更多监控功能

### 10.2 技术扩展

- **支持多平台**：支持Windows、Linux和macOS
- **支持移动端**：支持Android和iOS
- **支持Web版**：支持Web版操作控制端