# 虚拟公司AI管理系统 - 产品需求文档 (PRD)

## 1. 项目概述

### 1.1 产品愿景
构建一个基于多智能体架构的虚拟公司管理系统，通过AI协调者（董事长秘书）来管理和调度多个Claude子会话，实现智能化的企业运营管理。

### 1.2 核心价值
- **智能协调**: AI协调者统一管理多个专业化AI助手
- **动态管理**: 灵活调整规范和流程
- **实时交互**: WebSocket双向通信
- **模块化设计**: 易于扩展和维护

## 2. 技术架构
- **前端**: Vue 3 (CDN免构建) + WebSocket
- **后端**: FastAPI + Claude API + DuckDB
- **部署**: 极简化，只需Python环境

## 3. 核心CRUD对象（重点）

### 3.1 Session（会话）
AI专家会话，是系统的核心实体
- **属性**: id, type(coordinator/specialist), role, context, status, created_at
- **操作**: 创建新会话、查询会话状态、更新上下文、终止会话
- **关系**: 一个协调者会话可管理多个专家会话

### 3.2 Message（消息）
会话中的交互记录
- **属性**: id, session_id, content, sender(user/ai), metadata, timestamp
- **操作**: 发送消息、查询历史、搜索内容、批量导出
- **关系**: 属于特定会话，支持跨会话引用

### 3.3 Task（任务）
工作任务的抽象表示
- **属性**: id, title, description, assignee_session_id, status, priority, deadline
- **操作**: 创建任务、分配执行者、更新状态、查询进度
- **关系**: 可分配给特定AI专家，支持任务依赖

### 3.4 Knowledge（知识）
企业知识库条目
- **属性**: id, title, content, category, tags, vector_embedding, version
- **操作**: 添加知识、更新内容、矢量检索、版本管理
- **关系**: 可被所有AI访问，支持权限控制

### 3.5 Agent（智能体）
预定义的AI专家角色模板
- **属性**: id, name, role_prompt, capabilities, tools, constraints
- **操作**: 创建角色、更新能力、配置工具、设置约束
- **关系**: 用于实例化具体的Session

## 4. 系统工作流程

### 4.1 核心流程
1. 用户向董秘（AI协调者）提出需求
2. 董秘分析任务，决定是否需要专家协助
3. 如需要，董秘创建专家Session并分配Task
4. 专家执行任务，董秘监督进度
5. 董秘整合结果，向用户反馈

### 4.2 数据流
- 所有CRUD操作通过统一的数据引擎
- DuckDB存储结构化数据，支持复杂查询
- Knowledge支持矢量检索，实现语义搜索
- WebSocket保证实时性

## 5. 界面设计（极简版）

### 5.1 布局
- **左侧**: 与董秘对话的聊天窗口
- **右侧**: 虚拟公司看板（显示各专家状态、任务进度）

### 5.2 交互
- 用户只需与董秘对话
- 看板自动更新，展示公司运营状态
- 支持查看历史会话和任务详情

## 6. 技术实现要点

### 6.1 数据存储
- 使用DuckDB作为主数据库（支持SQL查询）
- 五大对象统一表结构设计
- 支持矢量存储用于Knowledge语义检索

### 6.2 CRUD引擎
- 统一的数据访问层
- 支持批量操作
- 自动维护关系完整性
- 内置权限控制

### 6.3 AI集成
- Claude API封装
- 会话上下文管理
- Token使用优化
- 错误重试机制

## 7. API设计原则

### 7.1 统一CRUD接口
- `/api/{object_type}` - 标准RESTful设计
- 支持过滤、排序、分页
- 批量操作支持
- WebSocket用于实时推送

### 7.2 五大对象端点
- `/api/sessions` - 会话管理
- `/api/messages` - 消息管理  
- `/api/tasks` - 任务管理
- `/api/knowledge` - 知识库管理
- `/api/agents` - 智能体模板管理

## 8. 开发计划

### 8.1 第一阶段：核心引擎 (2天)
- DuckDB数据模型初始化
- 五大对象的CRUD引擎实现
- 董秘Claude API集成
- 基础WebSocket通信

### 8.2 第二阶段：功能完善 (2天)
- Knowledge矢量检索实现
- 专家会话动态创建
- 任务分配和跟踪机制
- 上下文管理优化

### 8.3 第三阶段：界面实现 (1天)
- Vue3免构建单页应用
- 聊天界面和看板界面
- WebSocket实时更新
- 响应式布局

### 8.4 第四阶段：测试优化 (1天)
- 端到端流程测试
- 性能优化
- 部署脚本
- 使用文档

## 9. 成功指标

### 9.1 功能指标
- 董秘能管理五大CRUD对象
- 支持动态创建新Agent类型
- Knowledge矢量检索准确率 > 90%
- 多专家并行任务执行

### 9.2 技术指标
- 核心代码 < 1500行
- API响应时间 < 500ms
- 并发会话 > 10个
- 系统可用性 > 99%

## 10. 总结

本系统通过五大CRUD对象（Session、Message、Task、Knowledge、Agent）构建了一个完整的虚拟公司管理体系。董秘作为核心协调者，通过统一的CRUD引擎管理所有资源，实现了AI驱动的智能企业运营。

关键创新点：
1. 极简架构：免构建前端 + DuckDB + FastAPI
2. 统一数据模型：五大对象覆盖所有业务需求
3. 智能协作：董秘协调多个专家AI共同工作
4. 实时交互：WebSocket保证流畅体验